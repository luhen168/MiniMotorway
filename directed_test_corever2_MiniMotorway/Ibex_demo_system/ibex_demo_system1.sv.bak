// Copyright lowRISC contributors.
// Licensed under the Apache License, Version 2.0, see LICENSE for details.
// SPDX-License-Identifier: Apache-2.0

// The Ibex demo system, which instantiates and connects the following blocks:
// - Memory bus.
// - Ibex top module.
// - RAM memory to contain code and data.
// - GPIO driving logic.
// - UART for serial communication.
// - Timer.
// - Debug module.
// - SPI for driving LCD screen.
module ibex_demo_system  #(
    parameter ibex_pkg::regfile_e RegFile  = ibex_pkg::RegFileFPGA,
)(
    input  logic clk_sys_i,
    input  logic rst_sys_ni
);

  logic instr_req_o;
  logic instr_gnt_i;
  logic instr_rvalid_i;
  logic [31:0] instr_addr_o;
  logic [31:0] instr_rdata_i;

  logic data_req_o;
  logic data_rvalid_i;
  logic data_we_o;
  logic data_be_o;
  logic [31:0] data_addr_o;
  logic [31:0] data_wdata_o;
  logic [31:0] data_rdata_i;
  
  ibex_top #(
    .RegFile         ( RegFile                                 ),
    .MHPMCounterNum  ( 10                                      ),
    .RV32M           ( ibex_pkg::RV32MFast                     ),
    .RV32B           ( ibex_pkg::RV32BNone                     )
    // .DbgTriggerEn    ( DbgTriggerEn                            ),
    // .DbgHwBreakNum   ( DbgHwBreakNum                           ),
    // .DmHaltAddr      ( DEBUG_START + dm::HaltAddress[31:0]     ),
    // .DmExceptionAddr ( DEBUG_START + dm::ExceptionAddress[31:0])
  ) u_top (
    .clk_i (clk_sys_i),
    .rst_ni(rst_core_n),

    .test_en_i  ('b0),
    .scan_rst_ni(1'b1),
    .ram_cfg_i  ('b0),

    .hart_id_i  (32'b0),
    // First instruction executed is at 0x0 + 0x80.
    .boot_addr_i(32'h00100000),

    //Instruction Mem interface
    .instr_req_o       (instr_req_o),
    .instr_gnt_i       (),
    .instr_rvalid_i    (instr_rvalid_i),
    .instr_addr_o      (instr_addr_o),
    .instr_rdata_i     (instr_rdata_i),
    .instr_rdata_intg_i('0),
    .instr_err_i       ('0),

    //Data Mem interface
    .data_req_o       (data_req_o),
    .data_gnt_i       (),
    .data_rvalid_i    (data_rvalid_i),
    .data_we_o        (data_we_o),
    .data_be_o        (data_be_o),
    .data_addr_o      (data_addr_o),
    .data_wdata_o     (data_wdata_o),
    .data_wdata_intg_o(),
    .data_rdata_i     (data_rdata_i),
    .data_rdata_intg_i('0),
    .data_err_i       (),

    .irq_software_i(1'b0),
    .irq_timer_i   (),
    .irq_external_i(1'b0),
    .irq_fast_i    (),
    .irq_nm_i      (1'b0),

    .scramble_key_valid_i('0),
    .scramble_key_i      ('0),
    .scramble_nonce_i    ('0),
    .scramble_req_o      (),

    .debug_req_i        (),
    .crash_dump_o       (),
    .double_fault_seen_o(),

    .fetch_enable_i        ('1),
    .alert_minor_o         (),
    .alert_major_internal_o(),
    .alert_major_bus_o     (),
    .core_sleep_o          ()
  );


  ram_1p #(
    .Depth      () ,
    .MemInitFile ()
  ) imem (
    .clk_i(clk_sys_i),
    .rst_ni(rst_sys_ni),

    .req_i(instr_req_o),
    .we_i(),
    .be_i(),
    .addr_i(instr_addr_o),
    .wdata_i(),
    .rvalid_o(instr_rvalid_i),
    .rdata_o(instr_rdata_i)
  );

  ram_1p #( 
    .Depth      () ,
    .MemInitFile ()
  ) dmem (
    .clk_i(clk_sys_i),
    .rst_ni(rst_sys_ni),

    .req_i(data_req_o),
    .we_i(data_we_o),
    .be_i(data_be_o),
    .addr_i(data_addr_o),
    .wdata_i(data_wdata_o),
    .rvalid_o(data_rvalid_i),
    .rdata_o(data_rdata_i)
  );




endmodule
